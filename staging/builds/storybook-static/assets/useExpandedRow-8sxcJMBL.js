import{r as h}from"./index-CTjT7uj6.js";import{p as _,j as i,c as C}from"./settings-K-okNOOf.js";import{c as b}from"./deprecate-BLSDO8J_.js";import{u as R}from"./useFocusRowExpander-BfDxXWCM.js";import{l as $,k as f}from"./events-D0gen66i.js";const u=`${_.prefix}--datagrid`,j=r=>s=>{var e;const{row:t}=s,{expandedContentHeight:c}=t,l=(n,g="")=>{var x,a;if((x=n==null?void 0:n.target)!=null&&x.closest("tr").previousElementSibling){const o=(a=n==null?void 0:n.target)==null?void 0:a.closest("tr").previousElementSibling;g==="enter"?o.classList.add(`${u}__expandable-row--hover`):o.classList.remove(`${u}__expandable-row--hover`)}},{key:d,...p}=s;return i.jsx("tr",{className:b(`${u}__expanded-row`,{[`${u}__slug--row`]:h.isValidElement((e=t==null?void 0:t.original)==null?void 0:e.slug)}),onMouseEnter:n=>l(n,"enter"),onMouseLeave:n=>l(n),children:i.jsx("td",{className:`${u}__expanded-row-cell-wrapper`,children:i.jsx("div",{className:`${u}__expanded-row-content`,style:{height:c&&c},children:i.jsx(r,{...p},d)})})})},E=`${_.prefix}--datagrid`,w=r=>{const s=h.useRef(),t=h.useRef(),c=d=>{s.current=d};R({instance:s==null?void 0:s.current,lastExpandedRowIndex:t==null?void 0:t.current,blockClass:E,activeElement:document.activeElement});const l=d=>[{id:"expander",Cell:({row:e})=>{const n={...e.getToggleRowExpandedProps(),onClick:o=>{var m;o.stopPropagation(),e.toggleRowExpanded(),(m=e==null?void 0:e.onClick)==null||m.call(e,e,o),t.current=e.id}},{expanderButtonTitleExpanded:g="Collapse row",expanderButtonTitleCollapsed:x="Expand row"}=(s==null?void 0:s.current)||{},a=e.isExpanded?g:x;return e.canExpand&&i.jsx("button",{type:"button","aria-label":a,className:b(`${E}__row-expander`,`${C.prefix}--btn`,`${C.prefix}--btn--ghost`),...n,title:a,children:e.isExpanded?i.jsx($,{className:`${E}__row-expander--icon`}):i.jsx(f,{className:`${E}__row-expander--icon`})})},width:48,disableResizing:!0,disableSortBy:!0,Header:""},...d];r.visibleColumns.push(l),r.useInstance.push(c)},B=r=>{w(r);const s=t=>{const{rows:c,expandedContentHeight:l,ExpandedRowContentComponent:d,onRowExpand:p}=t,[e,n]=h.useState({}),g=(a,o)=>n({...e,[a]:o}),x=c.map(a=>({...a,canExpand:a.original&&!a.original.notExpandable,expandedContentHeight:e[a.index]||l,RowExpansionRenderer:j(d),onClick:(o,m)=>p==null?void 0:p(o,m)}));Object.assign(t,{rows:x,setExpandedRowHeight:g,withExpandedRows:!0})};r.useInstance.push(s)};export{B as u};
